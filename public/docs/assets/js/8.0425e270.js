(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{367:function(e,t,a){"use strict";a.r(t);var s=a(44),o=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h4",{attrs:{id:"_1-review-notes-on-milanote-to-gain-background-and-an-overarching-review"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-review-notes-on-milanote-to-gain-background-and-an-overarching-review"}},[e._v("#")]),e._v(" 1. Review Notes on Milanote to gain background and an overarching review")]),e._v(" "),a("h4",{attrs:{id:"_2-review-work-process-flow-to-understand-how-we-arrived-at-our-current-conclusions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-review-work-process-flow-to-understand-how-we-arrived-at-our-current-conclusions"}},[e._v("#")]),e._v(" 2. Review Work/Process flow to understand how we arrived at our current conclusions")]),e._v(" "),a("h4",{attrs:{id:"show-our-application-connected-to-the-keycloak-instance-as-a-client-not-a-provider"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#show-our-application-connected-to-the-keycloak-instance-as-a-client-not-a-provider"}},[e._v("#")]),e._v(" Show our application connected to the Keycloak instance as a client, not a provider:")]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("curl")]),e._v(" -k -X POST https://sit-login.geoplatform.info/auth/realms/geoplatform/protocol/openid-connect/token "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n-d "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("grant_type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("client_credentials "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n-d "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("client_id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("vanguard-sso "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n-d "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("client_secret")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("e69284c4-4f0a-4784-ab95-10e0dbb8651e "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n-d "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("scope")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("openid "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" jq "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'.'")]),e._v("\n")])])]),a("h4",{attrs:{id:"show-the-created-url-from-the-client-side-and-the-associated-misconfiguration-error"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#show-the-created-url-from-the-client-side-and-the-associated-misconfiguration-error"}},[e._v("#")]),e._v(" Show the created URL from the client side, and the associated misconfiguration error:")]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("curl")]),e._v(" -k -X POST https://idp.geoplatform.gov/simplesaml/module.php/core/login.php "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v(" \n-d "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("grant_type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("password "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n-d "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("as")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("geosamloauth "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n-d "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("username")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("nyuszi "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n-d "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("password")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("DEMO \n")])])]),a("h4",{attrs:{id:"as-a-single-liner"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#as-a-single-liner"}},[e._v("#")]),e._v(" "),a("em",[e._v("As a single-liner")])]),e._v(" "),a("p",[a("code",[e._v("curl -u nyuszi https://idp.geoplatform.gov/simplesaml/module.php/core/authenticate.php -d as=geosamloauth")])]),e._v(" "),a("h4",{attrs:{id:"resulting-code"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#resulting-code"}},[e._v("#")]),e._v(" Resulting Code")]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[e._v("https://idp.geoplatform.gov/simplesamlidp/module.php/core/loginuserpass.php\n?AuthState"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("_e19a5fcac210955179bab59ca6f57fca3335a8b614\n:https://idp.geoplatform.gov/simplesamlidp/module.php/core/as_login.php\n?AuthId"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("geosamloauth\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("ReturnTo")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("https://idp.geoplatform.gov/simplesamlidp/module.php/core/postredirect.php\n?RedirId"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("_6d1dff8b0a3a7fca19888b59a337186d2010b396a2\n")])])]),a("h4",{attrs:{id:"show-how-the-cookie-is-formed"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#show-how-the-cookie-is-formed"}},[e._v("#")]),e._v(" Show how the cookie is formed:")]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("curl")]),e._v(" -k -X POST https://idp.geoplatform.gov/simplesaml/module.php/core/authenticate.php "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v(" \n-d "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("grant_type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("password "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n-d "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("as")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("geosamloauth "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n-d "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("username")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("nyuszi "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n-d "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("password")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("DEMO \n")])])]),a("p",[e._v("Obviously not being appended to the URL, then grant_type")]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("curl")]),e._v(" -k -X POST https://idp.geoplatform.gov/simplesaml/module.php/core/authenticate.php "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v(" \n-d "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("as")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("geosamloauth "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n-d "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("username")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("nyuszi "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n-d "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("password")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("DEMO \n")])])]),a("p",[e._v("but this should actually work:\nThis is the initial URL:\nhttps://idp.geoplatform.gov/simplesamlidp")]),e._v(" "),a("p",[e._v("But this is what's returned:\nhttps://idp.geoplatform.gov/simplesamlidp/module.php/core/loginuserpass.php?AuthState=_dbe55dcbd4f0359247ce79e77e3b0eb6a5e6c32439%3Ahttps%3A%2F%2Fidp.geoplatform.gov%2Fsimplesamlidp%2Fmodule.php%2Fcore%2Fas_login.php%3FAuthId%3Dgeosamloauth%26ReturnTo%3Dhttps%253A%252F%252Fidp.geoplatform.gov%252Fsimplesamlidp%252Fmodule.php%252Fcore%252Fauthenticate.php%253Fas%253Dgeosamloauth")]),e._v(" "),a("p",[e._v("Visit a decoder online to make this more readable:\nhttps://meyerweb.com/eric/tools/dencoder/\nand then hit decode a few extra times")]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[e._v("https://idp.geoplatform.gov/simplesamlidp/module.php/core/loginuserpass.php\n?AuthState"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("_dbe55dcbd4f0359247ce79e77e3b0eb6a5e6c32439\n:https://idp.geoplatform.gov/simplesamlidp/module.php/core/as_login.php\n?AuthId"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("geosamloauth\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("ReturnTo")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("https://idp.geoplatform.gov/simplesamlidp/module.php/core/authenticate.php\n?as"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("geosamloauth\n")])])]),a("p",[e._v('This output actually shows us what course this GeoPlatform.gov login takes from the beginning and it\'s "ReturnTo" is what should ideally be mapped over to the Keycloak instance under "Redirect_URI" (though we typically just use a URI)')]),e._v(" "),a("p",[e._v("Note:")]),e._v(" "),a("ul",[a("li",[e._v('the "?" is indicating a parameter being queried from the resource pinged')]),e._v(" "),a("li",[e._v('the ":" is the requested entity name')]),e._v(" "),a("li",[e._v('the "&" is used to delimit query parameters, meaning link multiples but let you know where the next one sits')])]),e._v(" "),a("h4",{attrs:{id:"short-documentation-walk"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#short-documentation-walk"}},[e._v("#")]),e._v(" Short documentation walk")]),e._v(" "),a("ul",[a("li",[e._v('When we review the documentation here, regarding the methods to create "authsources" in SimpleSAML PHP:\nhttps://simplesamlphp.org/docs/stable/simplesamlphp-authsource')])]),e._v(" "),a("p",[e._v('We see that there are two effected classes that create this "authsource" (the foundational requirement for a Keycloak '),a("code",[e._v("id_token")]),e._v(" and this isn't unique to Keycloak, this is for any OpenID or OAuth2.0 "),a("code",[e._v("id_token")]),e._v(" requirement.")]),e._v(" "),a("p",[e._v("You can also see more about the authentication integration with the API built into SimpleSAML, as this authentication source must exist in "),a("code",[e._v("config/authsources.php")])]),e._v(" "),a("p",[e._v("and should be reflected as: "),a("code",[e._v("$auth = new \\SimpleSAML\\Auth\\Simple('default-sp');")])]),e._v(" "),a("p",[e._v("So let's search our documentation created from the pear based "),a("code",[e._v("phpDocumenter phar")]),e._v(" "),a("em",[e._v("(via "),a("code",[e._v("composer")]),e._v(")")]),e._v("\nwhere we search "),a("code",[e._v("authsources")]),e._v(", before we review the "),a("code",[e._v("config/authsources.php")]),e._v(" file")]),e._v(" "),a("p",[a("em",[e._v("This is where we come to find out that the user credentials is the actual grant_type being used to generate the authentication command/pass, and this is directly highlighted in the "),a("code",[e._v("config/authsources.php")]),e._v(" code")])]),e._v(" "),a("p",[e._v("Then as we review the "),a("code",[e._v("config/authmemcookie.php")]),e._v(" we can see the circular dependencies here, that unify the entire "),a("code",[e._v("authsources.php")]),e._v(" dependency which is the missing or mysterious "),a("code",[e._v("grant_type")]),e._v(" declaration required for the very URL redirection into Keycloak, which will always be a mystery as we don't know, nor do we want to know the user credentials.")]),e._v(" "),a("p",[e._v("Let's review the Keycloak information required on the client credentials side, and how we might see the differences between the clients and the identity providers "),a("em",[e._v("(the clients are supposed to be the service providers and the identity providers are what we just covered, whereby the assumption would have been that if everything is too convoluted to use the SimpleSAML PHP package as an identity provider, we could always fall back to using them as a client and merely giving the illusion of them as a provider, by utilizing two instances of Keycloak, serving as identity providers against each other, whereby one consumes the information from the SimpleSAML authorization source, and then passes that to the chief identity provision or identity broker at this point of the 1st Keycloak instance)")])]),e._v(" "),a("p",[e._v("Problems with this approach though, are just as troubling from the SimpleSAML PHP instance setup side/aspect.")]),e._v(" "),a("p",[e._v("This is the actual return state sent:")]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[e._v("https://idp.geoplatform.gov/simplesamlidp/module.php/core/loginuserpass.php\n?AuthState"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("_d6be85dad17de8c0964026af7f8238273ed3adec1c\n:https://idp.geoplatform.gov/simplesamlidp/module.php/core/as_login.php\n?AuthId"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("admin\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("ReturnTo")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("https://idp.geoplatform.gov/simplesamlidp/module.php/core/frontpage_welcome.php\n")])])]),a("p",[e._v("https://nyulacska.github.io/showcase-local/auth/_phpdoc/build/index.html")])])}),[],!1,null,null,null);t.default=o.exports}}]);